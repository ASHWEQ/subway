<!DOCTYPE html>
<html>
<head>
  <script src="http://d3js.org/d3.v4.min.js"></script>
  <style>
    html, body {
      height: 100%;
      margin: 0;
    }
    svg {
      background-color: #f8f8ff;
      height: 100%;
      width: 100%;
    }
  </style>
  <script src="subway.js"></script>
  <script src="routing_graph.js"></script>
  <script src="https://unpkg.com/js-heap@0.3.1/heap.js"></script>
  <script src="routing.js"></script>
</head>
<body>
  <script>
    let width = 500;
    let height = 500;
        
    let svg = d3.select("body").append("svg").attr("viewBox", '0 0 ' + width + ' ' + height);
    let {stations, lines} = subway;
    
    let allStationIds = Object.keys(stations);
    let nodes = allStationIds.map((id) => { return {id: id} });
    let nodesById = {};
    for (let node of nodes) nodesById[node.id] = node;
    
    let lineFunc = d3.line().x(id => nodesById[id].x).y(id => nodesById[id].y).curve(d3.curveLinear);
    let lineElements = svg.selectAll('.line').data(Object.values(lines)).enter().append('path').attr('class', 'line').attr('stroke', (l) => l.color).attr('stroke-width', 2).attr('fill', 'none');
    // .attr('d', (l) => lineFunc(l.stations))

    const simulation = d3.forceSimulation()
    .force('charge', d3.forceManyBody().strength(-0.5)) 
    .force('center', d3.forceCenter(width / 2, height / 2))
    
    let stopElements = svg.selectAll('.stop').data(nodes).enter().append('circle').attr('class', 'stop').attr('r', '1.5').attr('fill', 'black');
    
    
    simulation.nodes(nodes).on('tick', () => {
      stopElements.attr('cx', n => n.x).attr('cy', n => n.y);
      lineElements.attr('d', l => lineFunc(l.stations));
    });
        
  </script>
</body>
</html>
